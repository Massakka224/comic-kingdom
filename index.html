<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Comic Kingdom ‚Äì Version 14.0</title>

<style>
body{font-family:Arial;background:#f2f2f2;margin:0;padding-top:100px}
nav{position:fixed;top:0;left:0;right:0;background:#fff;padding:10px;display:flex;gap:5px;z-index:100}
nav button{flex:1;padding:10px;font-size:13px}
.section{display:none;padding:15px}
.section.active{display:block}
.box{background:#fff;padding:15px;border-radius:10px;margin-bottom:15px}
.skill{border:1px solid #ccc;padding:10px;margin:5px 0;position:relative}
.skill.locked{opacity:.5}
.skill button{position:absolute;right:10px;top:10px}
.progress{background:#ddd;height:14px;border-radius:7px;overflow:hidden}
.bar{background:#4caf50;height:100%;width:0%;transition:.3s}
.cooldown{color:red;font-size:12px}
</style>
</head>

<body>

<nav>
<button onclick="show('status')">Status</button>
<button onclick="show('skills')">Skills</button>
<button onclick="show('active')">Aktiv</button>
<button onclick="show('city')">Stadt</button>
</nav>

<div id="status" class="section active">
<div class="box">
<h2>Status</h2>
<p>Klasse: <b id="uiClass"></b></p>
<p>Level: <b id="uiLevel"></b></p>
<div class="progress"><div id="xpBar" class="bar"></div></div>
<p>XP: <b id="uiXP"></b></p>
<p>Skillpunkte: <b id="uiSP"></b></p>
<p>Angriff: <b id="uiAtk"></b></p>
<p>Verteidigung: <b id="uiDef"></b></p>
</div>
</div>

<div id="skills" class="section">
<div class="box">
<h2>üå≥ Skillb√§ume</h2>
<div id="skillBox"></div>
</div>
</div>

<div id="active" class="section">
<div class="box">
<h2>‚ö° Aktive Skills</h2>
<div id="activeBox"></div>
</div>
</div>

<div id="city" class="section">
<div class="box">
<h2>üèôÔ∏è Stadt</h2>
<button onclick="finishQuest()">Quest abschlie√üen</button><br><br>
<button onclick="respec()">Trainer: Skills zur√ºcksetzen</button>
</div>
</div>

<script>
/* ================= KONFIG ================= */
const SAVE_KEY="ck_save";
const SAVE_VERSION=2;

/* ================= LOAD / SAVE ================= */
function load(){try{return JSON.parse(localStorage.getItem(SAVE_KEY))||{}}catch{return{}}}
function save(){localStorage.setItem(SAVE_KEY,JSON.stringify(player))}

/* ================= KLASSEN ================= */
const classes={
  Krieger:{atk:3,def:2,skills:["Kampf","Verteidigung"]},
  Magier:{atk:1,def:1,skills:["Magie"]},
  Schurke:{atk:2,def:1,skills:["Kampf"]}
};

/* ================= AKTIVE SKILLS ================= */
const activeSkills={
  Krieger:[
    {id:"schlag",name:"M√§chtiger Schlag",cd:10,effect:()=>alert("üí• Extra Schaden!")}
  ],
  Magier:[
    {id:"feuer",name:"Feuerball",cd:12,effect:()=>alert("üî• Feuerball!")}
  ],
  Schurke:[
    {id:"stich",name:"Hinterhalt",cd:8,effect:()=>alert("üó°Ô∏è Kritischer Treffer!")}
  ]
};

/* ================= SKILLS ================= */
const skillData={
  Kampf:[
    {id:"kraft",name:"Kraft",max:5,atk:2},
    {id:"waffen",name:"Waffenmeister",max:3,atkMul:.1,req:{kraft:3}}
  ],
  Verteidigung:[
    {id:"zaehigkeit",name:"Z√§higkeit",max:5,def:2},
    {id:"eisenhaut",name:"Eisenhaut",max:3,defMul:.1,req:{zaehigkeit:3}}
  ],
  Magie:[
    {id:"fokus",name:"Fokus",max:3,xp:.05},
    {id:"arkane",name:"Arkane Macht",max:5,atk:3,req:{fokus:2}}
  ]
};
const allSkills=Object.values(skillData).flat();

/* ================= PLAYER ================= */
const data=load();
const player={
  version:SAVE_VERSION,
  class:data.class||"Krieger",
  level:data.level||1,
  xp:data.xp||0,
  xpMax:data.xpMax||100,
  skillPoints:data.skillPoints||0,
  skills:{},
  cooldowns:data.cooldowns||{}
};
allSkills.forEach(s=>player.skills[s.id]=Math.min(data.skills?.[s.id]||0,s.max));

/* ================= GAME ================= */
function show(id){
  document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

function finishQuest(){
  let xp=40*(1+(player.skills.fokus||0)*.05);
  player.xp+=Math.floor(xp);
  while(player.xp>=player.xpMax){
    player.xp-=player.xpMax;
    player.level++;
    player.skillPoints++;
    player.xpMax=Math.floor(player.xpMax*1.25);
  }
  save();updateUI();
}

function respec(){
  let total=0;
  for(let k in player.skills){total+=player.skills[k];player.skills[k]=0}
  player.skillPoints+=total;
  save();updateUI();
}

/* ================= STATS ================= */
function calcStats(){
  let atk=5+player.level+classes[player.class].atk;
  let def=5+player.level+classes[player.class].def;
  allSkills.forEach(s=>{
    const lvl=player.skills[s.id];
    if(s.atk) atk+=s.atk*lvl;
    if(s.def) def+=s.def*lvl;
    if(s.atkMul) atk*=1+s.atkMul*lvl;
    if(s.defMul) def*=1+s.defMul*lvl;
  });
  return{atk:Math.floor(atk),def:Math.floor(def)};
}

/* ================= RENDER ================= */
function renderSkills(){
  skillBox.innerHTML="";
  for(const tree in skillData){
    if(!classes[player.class].skills.includes(tree)) continue;
    skillBox.innerHTML+=`<h3>${tree}</h3>`;
    skillData[tree].forEach(s=>{
      const lvl=player.skills[s.id];
      skillBox.innerHTML+=`
      <div class="skill">
        <b>${s.name}</b> (${lvl}/${s.max})
        <button ${lvl>=s.max||player.skillPoints<=0?"disabled":""}
        onclick="player.skills['${s.id}']++;player.skillPoints--;save();updateUI()">+</button>
      </div>`;
    });
  }
}

function renderActive(){
  activeBox.innerHTML="";
  activeSkills[player.class].forEach(s=>{
    const cd=player.cooldowns[s.id]||0;
    activeBox.innerHTML+=`
    <div class="skill">
      <b>${s.name}</b><br>
      ${cd>0?`<span class="cooldown">Cooldown: ${cd}s</span>`:
      `<button onclick="useActive('${s.id}')">Benutzen</button>`}
    </div>`;
  });
}

function useActive(id){
  const skill=activeSkills[player.class].find(s=>s.id===id);
  if(!skill) return;
  skill.effect();
  player.cooldowns[id]=skill.cd;
  save();updateUI();
}

/* ================= TICK ================= */
setInterval(()=>{
  for(let k in player.cooldowns){
    if(player.cooldowns[k]>0) player.cooldowns[k]--;
  }
  updateUI();
},1000);

/* ================= UI ================= */
function updateUI(){
  const s=calcStats();
  uiClass.textContent=player.class;
  uiLevel.textContent=player.level;
  uiXP.textContent=`${player.xp}/${player.xpMax}`;
  uiSP.textContent=player.skillPoints;
  uiAtk.textContent=s.atk;
  uiDef.textContent=s.def;
  xpBar.style.width=(player.xp/player.xpMax*100)+"%";
  renderSkills();
  renderActive();
}
updateUI();
</script>
</body>
</html>
