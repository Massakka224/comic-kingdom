<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Comic Kingdom - Version 6.2 (Boss Drops)</title>
<style>
body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 1em; }
h1, h2 { text-align: center; }
button { width: 100%; padding: 1em; margin: 0.5em 0; font-size: 1.1em; }
.section { display: none; }
.section.active { display: block; }
.box { background: white; padding: 1em; margin: 1em 0; border-radius: 10px; }
.item { border: 1px solid #ddd; padding: 10px; margin: 5px 0; cursor: pointer; }
.item:hover { background: #eee; }
#modal { display:none; position:fixed; top:10%; left:10%; right:10%; background:white; padding:1em; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.3); }
</style>
</head>
<body>

<h1>Comic Kingdom</h1>
<nav>
  <button onclick="show('status')">Status</button>
  <button onclick="show('quests')">Quests</button>
  <button onclick="show('dungeon')">Dungeon</button>
  <button onclick="show('boss')">Boss</button>
  <button onclick="show('stadt')">Stadt</button>
  <button onclick="show('inventar')">Inventar</button>
  <button onclick="show('ausruestung')">Ausrüstung</button>
</nav>

<!-- Status -->
<div id="status" class="section active">
  <h2>Status</h2>
  <div class="box">
    <p>Level: <span id="level">1</span></p>
    <p>Gold: <span id="gold">50</span></p>
    <p>Energie: <span id="energy">100</span> / <span id="maxEnergy">100</span></p>
    <p>Schokolade: <span id="schoko">1</span></p>
    <p>Bestienkristalle: <span id="kristalle">0</span></p>
    <p>Klasse: <span id="klasse">Krieger</span></p>
  </div>
</div>

<!-- Quests -->
<div id="quests" class="section">
  <h2>Quests</h2>
  <div class="box">
    <button onclick="acceptQuest()">Quest annehmen</button>
    <button onclick="finishQuest()">Quest abschließen</button>
    <p id="questText">Keine aktive Quest</p>
  </div>
</div>

<!-- Dungeon -->
<div id="dungeon" class="section">
  <h2>Dungeon</h2>
  <div class="box">
    <button onclick="enterDungeon()">Dungeon betreten</button>
    <p id="dungeonText">Noch nicht implementiert</p>
  </div>
</div>

<!-- Boss -->
<div id="boss" class="section">
  <h2>Boss</h2>
  <div class="box">
    <button onclick="fightBoss()">Boss bekämpfen</button>
    <p id="bossText">Kein Boss aktiv</p>
  </div>
</div>

<!-- Stadt -->
<div id="stadt" class="section">
  <h2>Stadt</h2>
  <div class="box">
    <button onclick="cityGuard()">Stadtwache (Gold)</button>
    <button onclick="fillEnergyWithChocolate()">Energie mit Schokolade auffüllen</button>
  </div>
</div>

<!-- Inventar -->
<div id="inventar" class="section">
  <h2>Inventar</h2>
  <div class="box" id="inventoryList">Keine Items</div>
</div>

<!-- Ausrüstung -->
<div id="ausruestung" class="section">
  <h2>Ausrüstung</h2>
  <div class="box">
    <p><b>Slots:</b></p>
    <div id="slots"></div>
  </div>
</div>

<!-- Modal -->
<div id="modal">
  <div class="box">
    <h2>Item Details</h2>
    <div id="itemDetails"></div>
    <button onclick="closeModal()">Schließen</button>
  </div>
</div>

<script>
let level = 1;
let gold = 50;
let schoko = 1;
let kristalle = 0;
let questActive = false;
let maxEnergy = 100;
let energy = maxEnergy;
let klasse = "Krieger";

function show(id) {
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// ===== ITEM GENERATOR =====
const itemNames = {
  Waffe: ["Schwert", "Axt", "Dolch", "Stab", "Bogen"],
  Kopf: ["Helm", "Hut", "Krone"],
  Brust: ["Rüstung", "Tunika", "Roben"],
  Beine: ["Beinschienen", "Hose", "Gamaschen"],
  Handschuhe: ["Handschuhe", "Fäustlinge"],
  Schuhe: ["Stiefel", "Sandalen"],
  Ring: ["Ring", "Siegelring"],
  Amulett: ["Amulett", "Talisman"]
};

const rarities = [
  {name:"gewöhnlich", minLvl:1, chance:50},
  {name:"ungewöhnlich", minLvl:20, chance:25},
  {name:"selten", minLvl:30, chance:15},
  {name:"episch", minLvl:50, chance:7},
  {name:"legendär", minLvl:100, chance:3}
];

function randomFrom(arr) {
  return arr[Math.floor(Math.random() * arr.length)];
}

function generateItem(level, source="quest") {
  const slot = randomFrom(Object.keys(itemNames));
  const baseName = randomFrom(itemNames[slot]);
  const rarity = rarities.find(r => level >= r.minLvl && Math.random()*100 < r.chance) || rarities[0];

  const stats = {};
  if (slot === "Waffe") stats.schaden = Math.ceil(level * (0.5 + Math.random()));
  if (slot === "Brust") stats.leben = Math.ceil(level * (1 + Math.random()));
  if (slot === "Kopf") stats.resistenz = Math.ceil(level * (0.5 + Math.random()));
  if (slot === "Beine") stats.geschwindigkeit = Math.ceil(level * (0.3 + Math.random()));
  if (slot === "Handschuhe") stats.krit = Math.ceil(level * (0.1 + Math.random()));
  if (slot === "Schuhe") stats.ausdauer = Math.ceil(level * (0.4 + Math.random()));
  if (slot === "Ring") stats.mana = Math.ceil(level * (0.4 + Math.random()));
  if (slot === "Amulett") stats.intelligenz = Math.ceil(level * (0.5 + Math.random()));

  const classReq = ["Krieger", "Magier", "Nekromant", "Berserker"];
  const item = {
    id: Date.now() + Math.floor(Math.random()*1000),
    name: `${rarity.name} ${baseName}`,
    slot: slot,
    levelReq: level,
    classReq: classReq,
    rarity: rarity.name,
    stats: stats,
    upgradeLevel: 0,
    source: source
  };
  return item;
}

function generateManyItems(count, level, source="quest") {
  const items = [];
  for (let i=0; i<count; i++) {
    items.push(generateItem(level, source));
  }
  return items;
}

// ===== INVENTAR =====
let inventory = [];

function addToInventory(item) {
  inventory.push(item);
  updateInventoryUI();
}

function updateInventoryUI() {
  const inv = document.getElementById("inventoryList");
  if (inventory.length === 0) {
    inv.innerHTML = "Keine Items";
    return;
  }
  inv.innerHTML = "";
  inventory.forEach(item => {
    const el = document.createElement("div");
    el.className = "item";
    el.innerText = `${item.name} (Lvl ${item.levelReq})`;
    el.onclick = () => openItemModal(item.id);
    inv.appendChild(el);
  });
}

function openItemModal(itemId) {
  const item = inventory.find(i => i.id === itemId);
  if (!item) return;

  document.getElementById("modal").style.display = "block";
  document.getElementById("itemDetails").innerHTML = `
    <p><b>${item.name}</b></p>
    <p>Slot: ${item.slot}</p>
    <p>Rarität: ${item.rarity}</p>
    <p>Levelanforderung: ${item.levelReq}</p>
    <p>Stats: ${JSON.stringify(item.stats)}</p>
    <p>Quelle: ${item.source}</p>
  `;
}

function closeModal() {
  document.getElementById("modal").style.display = "none";
}

// ===== QUESTS =====
function acceptQuest() {
  if (questActive) {
    alert("Du hast bereits eine Quest.");
    return;
  }
  questActive = true;
  document.getElementById("questText").innerText = "Quest läuft… Monster bekämpfen.";
  show('quests');
}

function finishQuest() {
  if (!questActive) {
    alert("Keine aktive Quest.");
    return;
  }
  questActive = false;
  level++;
  gold += 20;
  document.getElementById("level").innerText = level;
  document.getElementById("gold").innerText = gold;
  document.getElementById("questText").innerText = "Quest abgeschlossen!";

  rewardItems("quest");
}

function rewardItems(source="quest") {
  const newItems = generateManyItems(3, level, source);
  newItems.forEach(item => addToInventory(item));
  alert("Du hast neue Items bekommen!");
}

// ===== BOSS =====
const bosses = [
  {name:"Riesiger Troll", levelReq:5, dropChance:40},
  {name:"Dunkler Drache", levelReq:20, dropChance:55},
  {name:"Königlicher Dämon", levelReq:50, dropChance:70}
];

function fightBoss() {
  const boss = bosses.find(b => level >= b.levelReq);
  if (!boss) {
    document.getElementById("bossText").innerText = "Kein Boss verfügbar. Level höher!";
    return;
  }

  document.getElementById("bossText").innerText = `Kämpfe gegen ${boss.name}...`;

  const won = Math.random() * 100 < 80; // 80% chance
  if (won) {
    document.getElementById("bossText").innerText = `Boss ${boss.name} besiegt!`;

    // Dropchance
    if (Math.random()*100 < boss.dropChance) {
      const drops = generateManyItems(1, level, "Boss");
      drops.forEach(item => addToInventory(item));
      alert("Boss Drop! Du hast ein Item bekommen!");
    } else {
      alert("Keine Beute diesmal.");
    }

  } else {
    document.getElementById("bossText").innerText = `Du wurdest besiegt...`;
  }
}

// ===== STADT =====
function cityGuard() {
  gold += 5;
  document.getElementById("gold").innerText = gold;
}

function fillEnergyWithChocolate() {
  if (schoko <= 0) {
    alert("Keine Schokolade.");
    return;
  }
  schoko--;
  energy = maxEnergy;
  document.getElementById("schoko").innerText = schoko;
  document.getElementById("energy").innerText = energy;
}
</script>
</body>
</html>
