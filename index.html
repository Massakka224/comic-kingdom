<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Comic Kingdom â€“ Version 21</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{font-family:Arial;background:#f2f2f2;margin:0;padding-top:80px}
nav{position:fixed;top:0;left:0;right:0;background:#fff;padding:10px;display:flex;gap:5px;z-index:10}
nav button{flex:1;padding:10px}
.section{display:none;padding:15px}
.section.active{display:block}
.box{background:#fff;padding:15px;border-radius:10px;margin-bottom:15px}
.item{border:1px solid #ccc;padding:10px;border-radius:8px;margin-bottom:6px}
.bar{background:#ddd;height:14px;border-radius:8px;overflow:hidden}
.bar span{display:block;height:100%}
.hp span{background:#e53935}
.xp span{background:#1e88e5}
#notifyBox{position:fixed;top:90px;right:10px;z-index:100}
.notify{background:#333;color:#fff;padding:10px;border-radius:8px;margin-bottom:6px;font-size:13px}
.city{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
</style>
</head>

<body>

<div id="notifyBox"></div>

<nav id="nav" style="display:none">
 <button onclick="show('status')">Status</button>
 <button onclick="show('quests')">Quests</button>
 <button onclick="show('city')">Stadt</button>
 <button onclick="show('inventory')">Inventar</button>
 <button onclick="logout()">Logout</button>
</nav>

<div id="charSelect" class="section active">
 <div class="box">
  <h3>Neuer Charakter</h3>
  <input id="nameInput" placeholder="Name"><br><br>
  <select id="classInput">
   <option value="">Klasse wÃ¤hlen</option>
   <option>Krieger</option>
   <option>Magier</option>
   <option>Kundschafter</option>
  </select><br><br>
  <button onclick="createCharacter()">Erstellen</button>
 </div>
</div>

<div id="status" class="section">
 <div class="box">
  <b id="uiName"></b> â€“ Level <b id="uiLevel"></b><br><br>
  HP<div class="bar hp"><span id="hpBar"></span></div>
  XP<div class="bar xp"><span id="xpBar"></span></div><br>
  ğŸŸ¡ Gold: <b id="uiGold"></b> | ğŸ« <b id="uiChoco"></b>
 </div>
</div>

<div id="quests" class="section">
 <div class="box">
  <div id="questBox"></div><br>
  <button onclick="startQuest(false)">Normale Quest</button>
  <button onclick="startQuest(true)">ğŸ‘‘ Boss-Quest</button>
 </div>
</div>

<div id="city" class="section">
 <div class="box">
  <h3>ğŸ° Stadt</h3>
  <div class="city">
   <button onclick="shop()">ğŸª HÃ¤ndler</button>
   <button onclick="arena()">ğŸŸ Arena</button>
   <button onclick="academy()">ğŸ° Akademie</button>
   <button onclick="tavern()">ğŸº Taverne</button>
   <button onclick="bank()">ğŸ¦ Bank</button>
   <button onclick="bossPortal()">ğŸ‘‘ Bossportal</button>
  </div>
 </div>
</div>

<div id="inventory" class="section">
 <div class="box">
  <h3>Inventar</h3>
  <div id="invBox"></div>
 </div>
</div>

<script>
const SAVE="ck_v21";
let player=JSON.parse(localStorage.getItem(SAVE));

const rarities=[
 {n:"gewÃ¶hnlich",m:1},
 {n:"ungewÃ¶hnlich",m:1.2},
 {n:"selten",m:1.5},
 {n:"episch",m:2},
 {n:"legendÃ¤r",m:3}
];

function notify(t){
 const d=document.createElement("div");
 d.className="notify";d.textContent=t;
 notifyBox.appendChild(d);
 setTimeout(()=>d.remove(),3000);
}

function createCharacter(){
 const n=nameInput.value.trim();
 const c=classInput.value;
 if(!n||!c)return;
 player={
  name:n,class:c,
  level:1,xp:0,xpMax:100,
  hp:120,hpMax:120,
  gold:100,chocolate:1,
  inventory:[],equip:{weapon:null,armor:null},
  quest:null,bank:0,
  bonusXP:1,arenaCD:0
 };
 save();nav.style.display="flex";show("status");
 notify("ğŸ® Willkommen "+n);
}

function genItem(boss=false){
 let max=player.level<20?2:player.level<40?3:4;
 if(boss && player.level>=40)max=4;
 const r=rarities[Math.floor(Math.random()*(max+1))];
 return{
  name:r.n+" Item",
  rarity:r.n,
  power:Math.floor(player.level*5*r.m)
 };
}

function startQuest(boss){
 if(player.quest)return;
 const dur=boss?7000:4000;
 player.quest={boss,end:Date.now()+dur};
 notify("ğŸ—º Quest gestartet");
}

function checkQuest(){
 if(!player?.quest)return;
 const left=Math.ceil((player.quest.end-Date.now())/1000);
 if(left>0){
  questBox.textContent=`Quest lÃ¤uft â€“ ${left}s`;
  return;
 }
 const boss=player.quest.boss;
 player.quest=null;
 const gold=boss?120:60;
 const xp=boss?150:80;
 player.gold+=gold;
 gainXP(xp);
 if(Math.random()<0.3||boss)player.inventory.push(genItem(boss));
 notify("âœ… Quest abgeschlossen");
}

function gainXP(x){
 player.xp+=x*player.bonusXP;
 while(player.xp>=player.xpMax){
  player.xp-=player.xpMax;
  player.level++;
  player.xpMax=Math.floor(player.xpMax*1.4);
  player.hpMax+=15;
  player.hp=player.hpMax;
  notify("ğŸ‰ Level Up!");
 }
}

function arena(){
 if(Date.now()<player.arenaCD)return notify("â³ Arena Cooldown");
 player.arenaCD=Date.now()+60000;
 const dmg=Math.floor(Math.random()*30+10);
 player.hp-=dmg;
 if(player.hp<=0){
  player.hp=player.hpMax;
  notify("ğŸ’€ Besiegt â€“ geheilt");
  return;
 }
 const g=50;
 player.gold+=g;
 notify("ğŸŸ Arena gewonnen +"+g+" Gold");
}

function academy(){
 if(player.gold<100)return notify("âŒ Zu wenig Gold");
 player.gold-=100;
 player.bonusXP+=0.1;
 notify("ğŸ° Akademie verbessert");
}

function tavern(){
 if(player.quest)return;
 startQuest(false);
 if(Math.random()<0.5){player.chocolate++;notify("ğŸ« Bonus erhalten");}
}

function shop(){
 if(player.gold<50)return;
 player.gold-=50;
 player.inventory.push(genItem());
 notify("ğŸª Item gekauft");
}

function bossPortal(){
 startQuest(true);
}

function bank(){
 const dep=Math.floor(player.gold/2);
 player.gold-=dep;
 player.bank+=dep;
 notify("ğŸ¦ "+dep+" Gold eingelagert");
}

function updateUI(){
 if(!player)return;
 uiName.textContent=player.name;
 uiLevel.textContent=player.level;
 uiGold.textContent=Math.floor(player.gold);
 uiChoco.textContent=player.chocolate;
 hpBar.style.width=(player.hp/player.hpMax*100)+"%";
 xpBar.style.width=(player.xp/player.xpMax*100)+"%";
 invBox.innerHTML=player.inventory.map(i=>`<div class="item">${i.name} (${i.power})</div>`).join("")||"Leer";
 save();
}

function show(id){
 document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
 document.getElementById(id).classList.add("active");
}

function logout(){
 localStorage.removeItem(SAVE);
 location.reload();
}

function save(){localStorage.setItem(SAVE,JSON.stringify(player))}

setInterval(()=>{checkQuest();updateUI()},1000);
if(player){nav.style.display="flex";show("status")}
</script>

</body>
</html>
