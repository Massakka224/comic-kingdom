<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Comic Kingdom â€“ Version 23.2</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial;background:#f2f2f2;margin:0;padding-top:80px}
nav{position:fixed;top:0;left:0;right:0;background:#fff;padding:10px;display:flex;gap:5px;z-index:10}
nav button{flex:1;padding:10px}
.section{display:none;padding:15px}
.section.active{display:block}
.box{background:#fff;padding:15px;border-radius:10px;margin-bottom:15px}
.item{border:1px solid #ccc;padding:10px;margin:5px 0;border-radius:8px}
.equip{background:#e3f2fd}
.bar{background:#ddd;border-radius:8px;height:14px;overflow:hidden}
.bar span{display:block;height:100%;background:#4caf50}
.xp span{background:#2196f3}
#notifyBox{position:fixed;top:90px;right:10px;z-index:100}
.notify{background:#333;color:#fff;padding:10px;border-radius:8px;margin-bottom:6px;font-size:13px}
small{opacity:.7}
button.small{padding:4px 8px;font-size:12px}
</style>
</head>

<body>

<div id="notifyBox"></div>

<nav id="nav" style="display:none">
 <button onclick="show('status')">Status</button>
 <button onclick="show('quests')">Quests</button>
 <button onclick="show('inventory')">Inventar</button>
 <button onclick="logout()">Logout</button>
</nav>

<div id="charSelect" class="section active">
 <div class="box">
  <h3>Neuer Charakter</h3>
  <input id="newName" placeholder="Name"><br><br>
  <select id="newClass">
   <option value="">Klasse wÃ¤hlen</option>
   <option>Krieger</option>
   <option>Magier</option>
   <option>Kundschafter</option>
  </select><br><br>
  <button onclick="createCharacter()">Erstellen</button>
 </div>
</div>

<div id="status" class="section">
 <div class="box">
  <b id="uiName"></b> â€“ Level <b id="uiLevel"></b><br><br>
  XP
  <div class="bar xp"><span id="xpBar"></span></div><br>
  Gold: <b id="uiGold"></b> | ğŸ« <b id="uiChoco"></b><br>
  <small id="bonusInfo"></small>
 </div>
</div>

<div id="quests" class="section">
 <div class="box">
  <button onclick="startQuest(false)">ğŸ—º Normale Quest</button>
  <button onclick="startQuest(true)">ğŸ‘‘ Boss-Quest</button>
  <div id="questBox"></div>
 </div>
</div>

<div id="inventory" class="section">
 <div class="box">
  <h3>ğŸ§¤ AusrÃ¼stung</h3>
  <div id="equipBox"></div>
 </div>

 <div class="box">
  <h3>ğŸ’ Inventar</h3>
  <div id="invBox"></div>
 </div>
</div>

<script>
const SAVE="comic_kingdom_v232";
let player=JSON.parse(localStorage.getItem(SAVE));

function notify(t){
 const d=document.createElement("div");
 d.className="notify";d.textContent=t;
 notifyBox.appendChild(d);
 setTimeout(()=>d.remove(),3000);
}

function save(){localStorage.setItem(SAVE,JSON.stringify(player))}

function show(id){
 document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
 document.getElementById(id).classList.add("active");
}

/* ===== SAVE REPAIR ===== */
function repairSave(){
 if(!player) return;
 player.inventory ??= [];
 player.equipment ??= {weapon:null,armor:null};
 player.quest ??= null;
 player.chocolate ??= 0;
}

/* ===== CHAR ===== */
function createCharacter(){
 const n=newName.value.trim(),c=newClass.value;
 if(!n||!c)return;
 player={
  name:n,class:c,
  level:1,xp:0,xpMax:100,
  gold:50,chocolate:0,
  inventory:[],quest:null,
  equipment:{weapon:null,armor:null}
 };
 save();nav.style.display="flex";show("status");
 notify("ğŸ® Charakter erstellt");
}

/* ===== ITEMS ===== */
function createItem(level,isBoss){
 const rar=["gewÃ¶hnlich","ungewÃ¶hnlich","selten","episch","legendÃ¤r"];
 const r=rar[Math.min(rar.length-1,Math.floor(level/8)+(isBoss?1:0))];
 const type=Math.random()>0.5?"weapon":"armor";
 return{
  id:crypto.randomUUID(),
  name:`${r}e ${type==="weapon"?"Waffe":"RÃ¼stung"}`,
  rarity:r,
  type,
  power:level*2+(r==="episch"?10:r==="legendÃ¤r"?25:0)
 };
}

/* ===== BONUS ===== */
function getBonuses(){
 let xp=1,gold=1,boss=1;
 if(player.equipment.weapon) xp+=player.equipment.weapon.power/100;
 if(player.equipment.armor){
  gold+=player.equipment.armor.power/120;
  boss+=player.equipment.armor.power/150;
 }
 return{xp,gold,boss};
}

/* ===== QUESTS ===== */
function startQuest(boss){
 if(player.quest)return;
 player.quest={boss,end:Date.now()+(boss?6000:4000)};
 notify(boss?"ğŸ‘‘ Bosskampf gestartet":"ğŸ—º Quest gestartet");
}

function checkQuest(){
 if(!player?.quest)return;
 if(Date.now()>=player.quest.end){
  const b=player.quest.boss;
  player.quest=null;
  const bonus=getBonuses();
  player.gold+=Math.floor((b?80:40)*bonus.gold);
  player.xp+=Math.floor((b?120:60)*bonus.xp);
  player.inventory.push(createItem(player.level,b));
  notify("ğŸ Item erhalten");

  while(player.xp>=player.xpMax){
   player.xp-=player.xpMax;
   player.level++;
   player.xpMax=Math.floor(player.xpMax*1.4);
   notify("ğŸ‰ Level Up!");
  }
 }
}

/* ===== INVENTAR ===== */
function equipItem(id){
 const i=player.inventory.find(x=>x.id===id);
 if(!i)return;
 player.inventory=player.inventory.filter(x=>x.id!==id);
 if(player.equipment[i.type]){
  player.inventory.push(player.equipment[i.type]);
 }
 player.equipment[i.type]=i;
 notify("ğŸ§¤ AusgerÃ¼stet");
}

function unequip(type){
 const i=player.equipment[type];
 if(!i)return;
 player.inventory.push(i);
 player.equipment[type]=null;
 notify("âŒ Abgelegt");
}

/* ===== UI ===== */
function updateUI(){
 if(!player)return;
 const bonus=getBonuses();
 uiName.textContent=player.name;
 uiLevel.textContent=player.level;
 uiGold.textContent=player.gold;
 uiChoco.textContent=player.chocolate;
 xpBar.style.width=(player.xp/player.xpMax*100)+"%";
 bonusInfo.textContent=`XP x${bonus.xp.toFixed(2)} | Gold x${bonus.gold.toFixed(2)}`;

 equipBox.innerHTML="";
 ["weapon","armor"].forEach(t=>{
  const e=player.equipment[t];
  equipBox.innerHTML+=e
   ? `<div class="item equip">${e.name} (+${e.power})
      <button class="small" onclick="unequip('${t}')">Ablegen</button></div>`
   : `<div class="item">Keine ${t==="weapon"?"Waffe":"RÃ¼stung"}</div>`;
 });

 invBox.innerHTML=player.inventory.length
  ? player.inventory.map(i=>`
   <div class="item">
    <b>${i.name}</b><br>
    Typ: ${i.type} | StÃ¤rke: ${i.power}<br>
    <button class="small" onclick="equipItem('${i.id}')">AusrÃ¼sten</button>
   </div>`).join("")
  : "<i>Inventar leer</i>";

 questBox.textContent=player.quest
  ? `Quest lÃ¤uft (${Math.ceil((player.quest.end-Date.now())/1000)}s)`
  : "Keine aktive Quest";

 save();
}

function logout(){localStorage.removeItem(SAVE);location.reload()}

if(player){repairSave();nav.style.display="flex";show("status")}
setInterval(()=>{checkQuest();updateUI()},1000);
</script>

</body>
</html>
