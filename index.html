<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Comic Kingdom â€“ Version 23</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{font-family:Arial;background:#f2f2f2;margin:0;padding-top:80px}
nav{position:fixed;top:0;left:0;right:0;background:#fff;padding:10px;display:flex;gap:5px;z-index:10}
nav button{flex:1;padding:10px}
.section{display:none;padding:15px}
.section.active{display:block}
.box{background:#fff;padding:15px;border-radius:10px;margin-bottom:15px}
.item{border:1px solid #ccc;padding:10px;margin:5px 0;border-radius:8px}
.equip{background:#e3f2fd}
.bar{background:#ddd;border-radius:8px;height:14px;overflow:hidden}
.bar span{display:block;height:100%;background:#4caf50}
.xp span{background:#2196f3}
#notifyBox{position:fixed;top:90px;right:10px;z-index:100}
.notify{background:#333;color:#fff;padding:10px;border-radius:8px;margin-bottom:6px;font-size:13px}
.cityGrid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
.cityGrid button{padding:12px}
small{opacity:.7}
</style>
</head>

<body>

<div id="notifyBox"></div>

<nav id="nav" style="display:none">
 <button onclick="show('status')">Status</button>
 <button onclick="show('quests')">Quests</button>
 <button onclick="show('city')">Stadt</button>
 <button onclick="show('inventory')">Inventar</button>
 <button onclick="logout()">Logout</button>
</nav>

<div id="charSelect" class="section active">
 <div class="box">
  <h3>Neuer Charakter</h3>
  <input id="newName" placeholder="Name"><br><br>
  <select id="newClass">
   <option value="">Klasse wÃ¤hlen</option>
   <option>Krieger</option>
   <option>Magier</option>
   <option>Kundschafter</option>
  </select><br><br>
  <button onclick="createCharacter()">Erstellen</button>
 </div>
</div>

<div id="status" class="section">
 <div class="box">
  <b id="uiName"></b> (<span id="uiClass"></span>) â€“ Level <b id="uiLevel"></b><br><br>
  HP<div class="bar"><span id="hpBar"></span></div>
  XP<div class="bar xp"><span id="xpBar"></span></div><br><br>
  Gold: <b id="uiGold"></b> | ğŸ« <b id="uiChoco"></b><br>
  <small>
   XP-Bonus: <span id="uiXPBonus"></span>x |
   Gold-Bonus: <span id="uiGoldBonus"></span>x
  </small>
 </div>

 <div class="box">
  <h4>ğŸ Tagesbelohnung</h4>
  <button onclick="dailyReward()">Abholen</button>
  <div id="dailyInfo"></div>
 </div>
</div>

<div id="quests" class="section">
 <div class="box">
  <h3>Quests</h3>
  <div id="questBox"></div><br>
  <button onclick="startQuest(false)">ğŸ—º Normale Quest</button>
  <button onclick="startQuest(true)">ğŸ‘‘ Boss-Quest</button>
 </div>
</div>

<div id="city" class="section">
 <div class="box">
  <h3>ğŸ° Stadt</h3>
  <div class="cityGrid">
   <button onclick="buyChocolate()">ğŸ« HÃ¤ndler</button>
   <button onclick="shop()">ğŸª Shop (Lvl <span id="shopLvl"></span>)</button>
   <button onclick="arena()">ğŸŸ Arena</button>
   <button onclick="academy()">ğŸ° Akademie (Lvl <span id="academyLvl"></span>)</button>
   <button onclick="bank()">ğŸ¦ Bank (Lvl <span id="bankLvl"></span>)</button>
   <button onclick="tavern()">ğŸº Taverne</button>
  </div>
 </div>
</div>

<div id="inventory" class="section">
 <div class="box">
  <h3>AusrÃ¼stung</h3>
  <div id="equipBox"></div>
 </div>
 <div class="box">
  <h3>Inventar</h3>
  <div id="invBox"></div>
 </div>
</div>

<script>
/* ================= CORE ================= */
const SAVE_KEY="comic_kingdom_save";
const GAME_VERSION=23;
let player=JSON.parse(localStorage.getItem(SAVE_KEY));

function migrate(p){
 if(!p)return null;
 p.version ??=1;
 p.inventory ??=[];
 p.chocolate ??=0;
 p.bonusXP ??=1;
 p.bonusGold ??=1;
 p.city ??={academy:1,bank:1,shop:1};
 p.equipment ??={weapon:null,armor:null};
 p.lastDaily ??=0;
 p.lastOnline ??=Date.now();
 p.version=GAME_VERSION;
 return p;
}
if(player){player=migrate(player);save();}

/* ================= UTIL ================= */
function save(){localStorage.setItem(SAVE_KEY,JSON.stringify(player))}
function notify(t){
 const d=document.createElement("div");
 d.className="notify";d.textContent=t;
 notifyBox.appendChild(d);
 setTimeout(()=>d.remove(),3000);
}
function show(id){
 document.querySelectorAll(".section").forEach(s=>s.classList.remove("active"));
 document.getElementById(id).classList.add("active");
}

/* ================= CHAR ================= */
function createCharacter(){
 const n=newName.value.trim();
 const c=newClass.value;
 if(!n||!c)return;
 player={
  version:GAME_VERSION,
  name:n,class:c,
  level:1,xp:0,xpMax:100,
  hp:100,hpMax:100,
  gold:50,chocolate:0,
  bonusXP:1,bonusGold:1,
  inventory:[],quest:null,
  equipment:{weapon:null,armor:null},
  city:{academy:1,bank:1,shop:1},
  lastDaily:0,lastOnline:Date.now()
 };
 save();nav.style.display="flex";show("status");
 notify("ğŸ® Charakter erstellt");
}

/* ================= ITEMS ================= */
function rarities(l,b){
 if(l<5)return["gewÃ¶hnlich"];
 if(l<10)return["gewÃ¶hnlich","ungewÃ¶hnlich"];
 if(l<20)return["gewÃ¶hnlich","ungewÃ¶hnlich","selten"];
 if(l<40)return b?["selten","episch"]:["gewÃ¶hnlich","ungewÃ¶hnlich","selten","episch"];
 return b?["episch","legendÃ¤r"]:["gewÃ¶hnlich","ungewÃ¶hnlich","selten","episch"];
}
function createItem(l,b){
 const r=rarities(l,b);
 const rarity=r[Math.floor(Math.random()*r.length)];
 const power=l*2+(rarity==="episch"?10:rarity==="legendÃ¤r"?25:0);
 const type=Math.random()>0.5?"weapon":"armor";
 return {name:`${rarity}e ${type==="weapon"?"Waffe":"RÃ¼stung"}`,rarity,power,type};
}

/* ================= QUESTS ================= */
function startQuest(boss){
 if(player.quest)return;
 player.quest={boss,end:Date.now()+(boss?7000:5000)};
 notify(boss?"ğŸ‘‘ Boss-Quest gestartet":"ğŸ—º Quest gestartet");
}
function checkQuest(){
 if(!player?.quest)return;
 if(Date.now()>=player.quest.end){
  const b=player.quest.boss;
  player.quest=null;
  player.gold+=(b?80:40)*player.bonusGold;
  player.xp+=(b?120:60)*player.bonusXP;
  player.inventory.push(createItem(player.level,b));
  notify("âœ… Quest abgeschlossen");
  while(player.xp>=player.xpMax){
   player.xp-=player.xpMax;
   player.level++;player.xpMax*=1.4;
   notify("ğŸ‰ Level Up!");
  }
 }
}

/* ================= CITY ================= */
function buyChocolate(){if(player.gold<20)return;player.gold-=20;player.chocolate++;notify("ğŸ« gekauft")}
function shop(){if(player.gold<30)return;player.gold-=30;player.inventory.push(createItem(player.level,false));notify("ğŸª Item gekauft")}
function arena(){if(Math.random()>0.4){const g=30*player.bonusGold;player.gold+=g;notify("ğŸŸ Sieg +"+g+" Gold")}else notify("ğŸ’€ Niederlage")}
function academy(){if(player.gold<50)return;player.gold-=50;player.city.academy++;player.bonusXP+=0.1;notify("ğŸ° Akademie Level Up")}
function bank(){player.city.bank++;notify("ğŸ¦ Bank verbessert")}
function tavern(){if(player.quest)return;startQuest(false);player.chocolate++;notify("ğŸº Extra-Quest")}

/* ================= DAILY ================= */
function dailyReward(){
 const now=Date.now();
 if(now-player.lastDaily<86400000)return;
 player.lastDaily=now;
 player.gold+=100;player.chocolate++;
 notify("ğŸ Tagesbelohnung erhalten");
}

/* ================= UI ================= */
function updateUI(){
 if(!player)return;
 uiName.textContent=player.name;
 uiClass.textContent=player.class;
 uiLevel.textContent=player.level;
 uiGold.textContent=Math.floor(player.gold);
 uiChoco.textContent=player.chocolate;
 uiXPBonus.textContent=player.bonusXP.toFixed(1);
 uiGoldBonus.textContent=player.bonusGold.toFixed(1);
 shopLvl.textContent=player.city.shop;
 academyLvl.textContent=player.city.academy;
 bankLvl.textContent=player.city.bank;
 xpBar.style.width=(player.xp/player.xpMax*100)+"%";
 questBox.textContent=player.quest?"Quest lÃ¤uft":"Keine aktive Quest";
 dailyInfo.textContent=(Date.now()-player.lastDaily>=86400000)?"VerfÃ¼gbar":"Schon abgeholt";
 invBox.innerHTML=player.inventory.map(i=>`<div class="item">${i.name} (${i.rarity})</div>`).join("")||"Leer";
 save();
}

function logout(){localStorage.removeItem(SAVE_KEY);location.reload()}
setInterval(()=>{checkQuest();updateUI()},1000);
if(player){nav.style.display="flex";show("status")}
</script>

</body>
</html>
