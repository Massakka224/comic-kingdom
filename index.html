<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Comic Kingdom ‚Äì Version 11.4.2</title>

<style>
body {
  font-family: Arial, sans-serif;
  background:#f2f2f2;
  margin:0;
  padding-top:90px;
}

nav {
  position:fixed;
  top:0; left:0; right:0;
  background:#fff;
  padding:10px;
  display:flex;
  gap:5px;
  z-index:100;
}

nav button {
  flex:1;
  padding:10px;
  font-size:14px;
}

.section { display:none; padding:15px; }
.section.active { display:block; }

.box {
  background:#fff;
  padding:15px;
  border-radius:10px;
  margin-bottom:15px;
}

.item {
  border:1px solid #ccc;
  padding:10px;
  margin:5px 0;
  cursor:pointer;
}
.item:hover { background:#eee; }
</style>
</head>

<body>

<nav>
<button onclick="showSection('status')">Status</button>
<button onclick="showSection('quests')">Quests</button>
<button onclick="showSection('stadt')">Stadt</button>
<button onclick="showSection('inventar')">Inventar</button>
</nav>

<!-- STATUS -->
<div id="status" class="section active">
<div class="box">
<h2>Status</h2>
<p>Klasse: <b id="uiClass"></b></p>
<p>Level: <b id="uiLevel"></b></p>
<p>XP: <b id="uiXP"></b></p>
<p>Gold: <b id="uiGold"></b></p>
<button onclick="resetGame()">Spielstand l√∂schen</button>
</div>
</div>

<!-- QUESTS -->
<div id="quests" class="section">
<div class="box">
<h2>Quest</h2>
<button onclick="finishQuest()">Quest abschlie√üen</button>
<p id="questLog"></p>
</div>
</div>

<!-- STADT -->
<div id="stadt" class="section">
<div class="box">
<h2>Stadt</h2>
<ul>
<li>üè≠ Schmiede ‚Äì sp√§ter</li>
<li>üç∫ Taverne ‚Äì sp√§ter</li>
<li>üßô Magierturm ‚Äì sp√§ter</li>
</ul>
</div>
</div>

<!-- INVENTAR -->
<div id="inventar" class="section">
<div class="box">
<h2>Inventar</h2>
<div id="inventoryBox">Inventar leer</div>
</div>
</div>

<script>
// ===================== VERSION =====================
const GAME_VERSION = "11.4.2";

// ===================== SAVE SYSTEM =====================
function loadPlayer() {
  try {
    const data = localStorage.getItem("comicKingdomSave");
    if (!data) return null;

    const parsed = JSON.parse(data);

    if (parsed.version !== GAME_VERSION) {
      parsed.version = GAME_VERSION; // Migration
    }

    return parsed;
  } catch {
    localStorage.removeItem("comicKingdomSave");
    return null;
  }
}

function savePlayer() {
  localStorage.setItem("comicKingdomSave", JSON.stringify(player));
}

// ===================== PLAYER =====================
let player = loadPlayer() || {
  version: GAME_VERSION,
  class: "Krieger",
  level: 1,
  xp: 0,
  xpMax: 100,
  gold: 50,
  inventory: [],
  nextItemId: 1
};

// ===================== DATA =====================
const classItems = {
  Krieger: ["Schwert der Ehre","Axt des Zorns","Titanenklinge"],
  Magier: ["Stab der Weisheit","Flammenfokus"],
  Kundschafter: ["Dolch der Schatten","Bogen des Windes"],
  Nekromant: ["Seelensichel","Fluchstab"]
};

const itemSlots = ["Waffe","Helm","R√ºstung","Ring"];

const qualities = [
  { name:"Gew√∂hnlich", min:1, weight:50 },
  { name:"Ungew√∂hnlich", min:20, weight:25 },
  { name:"Selten", min:30, weight:15 },
  { name:"Episch", min:100, weight:7 },
  { name:"Legend√§r", min:150, weight:3 }
];

// ===================== NAV =====================
function showSection(id) {
  document.querySelectorAll(".section").forEach(s => s.classList.remove("active"));
  document.getElementById(id)?.classList.add("active");
}

// ===================== ITEM SYSTEM =====================
function getWeightedQuality() {
  const possible = qualities.filter(q => player.level >= q.min);
  const pool = [];
  possible.forEach(q => {
    for (let i = 0; i < q.weight; i++) pool.push(q);
  });
  return pool[Math.floor(Math.random() * pool.length)];
}

function generateItem() {
  const quality = getWeightedQuality();
  const names = classItems[player.class];

  return {
    id: player.nextItemId++,
    name: names[Math.floor(Math.random() * names.length)],
    quality: quality.name,
    level: player.level,
    slot: itemSlots[Math.floor(Math.random() * itemSlots.length)],
    classReq: player.class
  };
}

// ===================== QUEST =====================
function finishQuest() {
  const xpGain = 40;
  const goldGain = 20;

  player.xp += xpGain;
  player.gold += goldGain;

  let leveledUp = false;
  while (player.xp >= player.xpMax) {
    player.xp -= player.xpMax;
    player.level++;
    player.xpMax = Math.floor(player.xpMax * 1.25);
    leveledUp = true;
  }

  const item = generateItem();
  player.inventory.push(item);

  document.getElementById("questLog").innerHTML =
    `+${xpGain} XP<br>
     +${goldGain} Gold<br>
     Beute: <b>${item.name}</b> (${item.quality})<br>
     ${leveledUp ? "<b>LEVEL UP!</b>" : ""}`;

  savePlayer();
  updateUI();
}

// ===================== RESET =====================
function resetGame() {
  if (!confirm("Willst du deinen Spielstand wirklich l√∂schen?")) return;
  localStorage.removeItem("comicKingdomSave");
  location.reload();
}

// ===================== UI =====================
function updateUI() {
  document.getElementById("uiClass").innerText = player.class;
  document.getElementById("uiLevel").innerText = player.level;
  document.getElementById("uiXP").innerText = `${player.xp} / ${player.xpMax}`;
  document.getElementById("uiGold").innerText = player.gold;

  const inv = document.getElementById("inventoryBox");
  inv.innerHTML = "";

  if (player.inventory.length === 0) {
    inv.innerText = "Inventar leer";
    return;
  }

  player.inventory.forEach(item => {
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML =
      `<b>${item.name}</b><br>
       ${item.quality} | ${item.slot}<br>
       Klasse: ${item.classReq}`;
    div.onclick = () => {
      alert(
        `Item: ${item.name}\n` +
        `Qualit√§t: ${item.quality}\n` +
        `Slot: ${item.slot}\n` +
        `Klasse: ${item.classReq}`
      );
    };
    inv.appendChild(div);
  });
}

updateUI();
</script>

</body>
</html>
